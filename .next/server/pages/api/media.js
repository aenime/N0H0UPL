"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/media";
exports.ids = ["pages/api/media"];
exports.modules = {

/***/ "(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fmedia&preferredRegion=&absolutePagePath=.%2Fsrc%2Fpages%2Fapi%2Fmedia.js&middlewareConfigBase64=e30%3D!":
/*!**********************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fmedia&preferredRegion=&absolutePagePath=.%2Fsrc%2Fpages%2Fapi%2Fmedia.js&middlewareConfigBase64=e30%3D! ***!
  \**********************************************************************************************************************************************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/route-modules/pages-api/module.compiled */ \"(api-node)/./node_modules/next/dist/server/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/route-kind */ \"(api-node)/./node_modules/next/dist/server/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api-node)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _src_pages_api_media_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/pages/api/media.js */ \"(api-node)/./src/pages/api/media.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_src_pages_api_media_js__WEBPACK_IMPORTED_MODULE_3__]);\n_src_pages_api_media_js__WEBPACK_IMPORTED_MODULE_3__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_src_pages_api_media_js__WEBPACK_IMPORTED_MODULE_3__, 'default'));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_src_pages_api_media_js__WEBPACK_IMPORTED_MODULE_3__, 'config');\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/media\",\n        pathname: \"/api/media\",\n        // The following aren't used in production.\n        bundlePath: '',\n        filename: ''\n    },\n    userland: _src_pages_api_media_js__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL25vZGVfbW9kdWxlcy9uZXh0L2Rpc3QvYnVpbGQvd2VicGFjay9sb2FkZXJzL25leHQtcm91dGUtbG9hZGVyL2luZGV4LmpzP2tpbmQ9UEFHRVNfQVBJJnBhZ2U9JTJGYXBpJTJGbWVkaWEmcHJlZmVycmVkUmVnaW9uPSZhYnNvbHV0ZVBhZ2VQYXRoPS4lMkZzcmMlMkZwYWdlcyUyRmFwaSUyRm1lZGlhLmpzJm1pZGRsZXdhcmVDb25maWdCYXNlNjQ9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7OztBQUErRjtBQUN2QztBQUNFO0FBQzFEO0FBQ3FEO0FBQ3JEO0FBQ0EsaUVBQWUsd0VBQUssQ0FBQyxvREFBUSxZQUFZLEVBQUM7QUFDMUM7QUFDTyxlQUFlLHdFQUFLLENBQUMsb0RBQVE7QUFDcEM7QUFDTyx3QkFBd0IseUdBQW1CO0FBQ2xEO0FBQ0EsY0FBYyxrRUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLFlBQVk7QUFDWixDQUFDOztBQUVELHFDIiwic291cmNlcyI6WyIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUGFnZXNBUElSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL3JvdXRlLW1vZHVsZXMvcGFnZXMtYXBpL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgaG9pc3QgfSBmcm9tIFwibmV4dC9kaXN0L2J1aWxkL3RlbXBsYXRlcy9oZWxwZXJzXCI7XG4vLyBJbXBvcnQgdGhlIHVzZXJsYW5kIGNvZGUuXG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiLi9zcmMvcGFnZXMvYXBpL21lZGlhLmpzXCI7XG4vLyBSZS1leHBvcnQgdGhlIGhhbmRsZXIgKHNob3VsZCBiZSB0aGUgZGVmYXVsdCBleHBvcnQpLlxuZXhwb3J0IGRlZmF1bHQgaG9pc3QodXNlcmxhbmQsICdkZWZhdWx0Jyk7XG4vLyBSZS1leHBvcnQgY29uZmlnLlxuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IGhvaXN0KHVzZXJsYW5kLCAnY29uZmlnJyk7XG4vLyBDcmVhdGUgYW5kIGV4cG9ydCB0aGUgcm91dGUgbW9kdWxlIHRoYXQgd2lsbCBiZSBjb25zdW1lZC5cbmV4cG9ydCBjb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBQYWdlc0FQSVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5QQUdFU19BUEksXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9tZWRpYVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL21lZGlhXCIsXG4gICAgICAgIC8vIFRoZSBmb2xsb3dpbmcgYXJlbid0IHVzZWQgaW4gcHJvZHVjdGlvbi5cbiAgICAgICAgYnVuZGxlUGF0aDogJycsXG4gICAgICAgIGZpbGVuYW1lOiAnJ1xuICAgIH0sXG4gICAgdXNlcmxhbmRcbn0pO1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1wYWdlcy1hcGkuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fmedia&preferredRegion=&absolutePagePath=.%2Fsrc%2Fpages%2Fapi%2Fmedia.js&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api-node)/./src/pages/api/media.js":
/*!********************************!*\
  !*** ./src/pages/api/media.js ***!
  \********************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var _utils_mongodb__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../utils/mongodb */ \"(api-node)/./src/utils/mongodb.ts\");\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! mongodb */ \"mongodb\");\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(mongodb__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var formidable__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! formidable */ \"formidable\");\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! fs */ \"fs\");\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(fs__WEBPACK_IMPORTED_MODULE_3__);\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_4__);\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([formidable__WEBPACK_IMPORTED_MODULE_2__]);\nformidable__WEBPACK_IMPORTED_MODULE_2__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\n\nconst config = {\n    api: {\n        bodyParser: false\n    }\n};\nasync function handler(req, res) {\n    const { db } = await (0,_utils_mongodb__WEBPACK_IMPORTED_MODULE_0__.connectToDatabase)();\n    // GET - Fetch all media files\n    if (req.method === 'GET') {\n        try {\n            const { category, search, page = 1, limit = 20 } = req.query;\n            let query = {};\n            if (category && category !== 'all') {\n                query.category = category;\n            }\n            if (search) {\n                query.$or = [\n                    {\n                        filename: {\n                            $regex: search,\n                            $options: 'i'\n                        }\n                    },\n                    {\n                        title: {\n                            $regex: search,\n                            $options: 'i'\n                        }\n                    },\n                    {\n                        description: {\n                            $regex: search,\n                            $options: 'i'\n                        }\n                    }\n                ];\n            }\n            const skip = (parseInt(page) - 1) * parseInt(limit);\n            const media = await db.collection('media').find(query).sort({\n                createdAt: -1\n            }).skip(skip).limit(parseInt(limit)).toArray();\n            const total = await db.collection('media').countDocuments(query);\n            return res.status(200).json({\n                success: true,\n                media: media.map((item)=>({\n                        ...item,\n                        id: item._id.toString()\n                    })),\n                pagination: {\n                    current: parseInt(page),\n                    total: Math.ceil(total / parseInt(limit)),\n                    count: total\n                }\n            });\n        } catch (error) {\n            console.error('Error fetching media:', error);\n            return res.status(500).json({\n                success: false,\n                error: 'Failed to fetch media'\n            });\n        }\n    }\n    // POST - Upload new media file\n    if (req.method === 'POST') {\n        try {\n            const uploadDir = path__WEBPACK_IMPORTED_MODULE_4___default().join(process.cwd(), 'public/uploads');\n            // Create upload directory if it doesn't exist\n            if (!fs__WEBPACK_IMPORTED_MODULE_3___default().existsSync(uploadDir)) {\n                fs__WEBPACK_IMPORTED_MODULE_3___default().mkdirSync(uploadDir, {\n                    recursive: true\n                });\n            }\n            const form = (0,formidable__WEBPACK_IMPORTED_MODULE_2__[\"default\"])({\n                uploadDir,\n                keepExtensions: true,\n                maxFileSize: 10 * 1024 * 1024\n            });\n            const [fields, files] = await form.parse(req);\n            const file = Array.isArray(files.file) ? files.file[0] : files.file;\n            const title = Array.isArray(fields.title) ? fields.title[0] : fields.title;\n            const description = Array.isArray(fields.description) ? fields.description[0] : fields.description;\n            const category = Array.isArray(fields.category) ? fields.category[0] : fields.category;\n            if (!file) {\n                return res.status(400).json({\n                    success: false,\n                    error: 'No file uploaded'\n                });\n            }\n            // Generate unique filename\n            const fileExtension = path__WEBPACK_IMPORTED_MODULE_4___default().extname(file.originalFilename);\n            const uniqueId = `media_${Date.now()}_${Math.random().toString(36).substring(2, 15)}`;\n            const filename = `${uniqueId}${fileExtension}`;\n            const newPath = path__WEBPACK_IMPORTED_MODULE_4___default().join(uploadDir, filename);\n            // Move file to final location\n            fs__WEBPACK_IMPORTED_MODULE_3___default().renameSync(file.filepath, newPath);\n            // Determine file type\n            const mimeType = file.mimetype;\n            let fileType = 'unknown';\n            if (mimeType.startsWith('image/')) {\n                fileType = 'image';\n            } else if (mimeType.startsWith('video/')) {\n                fileType = 'video';\n            }\n            // Save to database\n            const mediaDoc = {\n                id: uniqueId,\n                filename,\n                originalFilename: file.originalFilename,\n                title: title || file.originalFilename,\n                description: description || '',\n                category: category || 'uncategorized',\n                fileType,\n                mimeType,\n                size: file.size,\n                url: `/uploads/${filename}`,\n                createdAt: new Date(),\n                updatedAt: new Date(),\n                usedInPosts: [],\n                tags: []\n            };\n            await db.collection('media').insertOne(mediaDoc);\n            return res.status(200).json({\n                success: true,\n                media: {\n                    ...mediaDoc,\n                    id: mediaDoc.id\n                }\n            });\n        } catch (error) {\n            console.error('Error uploading media:', error);\n            return res.status(500).json({\n                success: false,\n                error: 'Failed to upload media'\n            });\n        }\n    }\n    // PUT - Update media metadata\n    if (req.method === 'PUT') {\n        try {\n            const { id, title, description, category, tags } = req.body;\n            if (!id) {\n                return res.status(400).json({\n                    success: false,\n                    error: 'Media ID is required'\n                });\n            }\n            const updateDoc = {\n                title,\n                description,\n                category,\n                tags: tags || [],\n                updatedAt: new Date()\n            };\n            await db.collection('media').updateOne({\n                id\n            }, {\n                $set: updateDoc\n            });\n            return res.status(200).json({\n                success: true,\n                message: 'Media updated successfully'\n            });\n        } catch (error) {\n            console.error('Error updating media:', error);\n            return res.status(500).json({\n                success: false,\n                error: 'Failed to update media'\n            });\n        }\n    }\n    // DELETE - Delete media file\n    if (req.method === 'DELETE') {\n        try {\n            const { id } = req.query;\n            if (!id) {\n                return res.status(400).json({\n                    success: false,\n                    error: 'Media ID is required'\n                });\n            }\n            // Find media document - check both id and _id fields\n            let media = await db.collection('media').findOne({\n                id\n            });\n            if (!media) {\n                // Try finding by _id if id field doesn't exist (only if it's a valid ObjectId)\n                try {\n                    if (mongodb__WEBPACK_IMPORTED_MODULE_1__.ObjectId.isValid(id)) {\n                        media = await db.collection('media').findOne({\n                            _id: new mongodb__WEBPACK_IMPORTED_MODULE_1__.ObjectId(id)\n                        });\n                    }\n                } catch (err) {\n                // Invalid ObjectId, continue with original error\n                }\n            }\n            if (!media) {\n                return res.status(404).json({\n                    success: false,\n                    error: 'Media not found'\n                });\n            }\n            // Delete file from filesystem\n            const filePath = path__WEBPACK_IMPORTED_MODULE_4___default().join(process.cwd(), 'public/uploads', media.filename);\n            if (fs__WEBPACK_IMPORTED_MODULE_3___default().existsSync(filePath)) {\n                fs__WEBPACK_IMPORTED_MODULE_3___default().unlinkSync(filePath);\n            }\n            // Delete from database - use the _id for reliable deletion\n            await db.collection('media').deleteOne({\n                _id: media._id\n            });\n            return res.status(200).json({\n                success: true,\n                message: 'Media deleted successfully'\n            });\n        } catch (error) {\n            console.error('Error deleting media:', error);\n            return res.status(500).json({\n                success: false,\n                error: 'Failed to delete media'\n            });\n        }\n    }\n    return res.status(405).json({\n        error: 'Method not allowed'\n    });\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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b0JBQ1RXLE9BQU87Z0JBQ1Q7WUFDRjtZQUVBLDhCQUE4QjtZQUM5QixNQUFNZ0QsV0FBVzNGLGdEQUFTLENBQUMrQyxRQUFRQyxHQUFHLElBQUksa0JBQWtCMUIsTUFBTVAsUUFBUTtZQUMxRSxJQUFJaEIsb0RBQWEsQ0FBQzRGLFdBQVc7Z0JBQzNCNUYsb0RBQWEsQ0FBQzRGO1lBQ2hCO1lBRUEsMkRBQTJEO1lBQzNELE1BQU1wRixHQUFHZ0IsVUFBVSxDQUFDLFNBQVNzRSxTQUFTLENBQUM7Z0JBQUV6RCxLQUFLZCxNQUFNYyxHQUFHO1lBQUM7WUFFeEQsT0FBTzlCLElBQUl3QixNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO2dCQUMxQkMsU0FBUztnQkFDVHVELFNBQVM7WUFDWDtRQUNGLEVBQUUsT0FBTzVDLE9BQU87WUFDZEMsUUFBUUQsS0FBSyxDQUFDLHlCQUF5QkE7WUFDdkMsT0FBT3JDLElBQUl3QixNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO2dCQUMxQkMsU0FBUztnQkFDVFcsT0FBTztZQUNUO1FBQ0Y7SUFDRjtJQUVBLE9BQU9yQyxJQUFJd0IsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztRQUFFWSxPQUFPO0lBQXFCO0FBQzVEIiwic291cmNlcyI6WyIvVXNlcnMvYW5hbmQuc29jaWFsL0RvY3VtZW50cy9uMGgwdXBsL3NyYy9wYWdlcy9hcGkvbWVkaWEuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY29ubmVjdFRvRGF0YWJhc2UgfSBmcm9tICcuLi8uLi91dGlscy9tb25nb2RiJztcbmltcG9ydCB7IE9iamVjdElkIH0gZnJvbSAnbW9uZ29kYic7XG5pbXBvcnQgZm9ybWlkYWJsZSBmcm9tICdmb3JtaWRhYmxlJztcbmltcG9ydCBmcyBmcm9tICdmcyc7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcblxuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IHtcbiAgYXBpOiB7XG4gICAgYm9keVBhcnNlcjogZmFsc2UsXG4gIH0sXG59O1xuXG5leHBvcnQgZGVmYXVsdCBhc3luYyBmdW5jdGlvbiBoYW5kbGVyKHJlcSwgcmVzKSB7XG4gIGNvbnN0IHsgZGIgfSA9IGF3YWl0IGNvbm5lY3RUb0RhdGFiYXNlKCk7XG5cbiAgLy8gR0VUIC0gRmV0Y2ggYWxsIG1lZGlhIGZpbGVzXG4gIGlmIChyZXEubWV0aG9kID09PSAnR0VUJykge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB7IGNhdGVnb3J5LCBzZWFyY2gsIHBhZ2UgPSAxLCBsaW1pdCA9IDIwIH0gPSByZXEucXVlcnk7XG4gICAgICBcbiAgICAgIGxldCBxdWVyeSA9IHt9O1xuICAgICAgaWYgKGNhdGVnb3J5ICYmIGNhdGVnb3J5ICE9PSAnYWxsJykge1xuICAgICAgICBxdWVyeS5jYXRlZ29yeSA9IGNhdGVnb3J5O1xuICAgICAgfVxuICAgICAgaWYgKHNlYXJjaCkge1xuICAgICAgICBxdWVyeS4kb3IgPSBbXG4gICAgICAgICAgeyBmaWxlbmFtZTogeyAkcmVnZXg6IHNlYXJjaCwgJG9wdGlvbnM6ICdpJyB9IH0sXG4gICAgICAgICAgeyB0aXRsZTogeyAkcmVnZXg6IHNlYXJjaCwgJG9wdGlvbnM6ICdpJyB9IH0sXG4gICAgICAgICAgeyBkZXNjcmlwdGlvbjogeyAkcmVnZXg6IHNlYXJjaCwgJG9wdGlvbnM6ICdpJyB9IH1cbiAgICAgICAgXTtcbiAgICAgIH1cblxuICAgICAgY29uc3Qgc2tpcCA9IChwYXJzZUludChwYWdlKSAtIDEpICogcGFyc2VJbnQobGltaXQpO1xuICAgICAgXG4gICAgICBjb25zdCBtZWRpYSA9IGF3YWl0IGRiLmNvbGxlY3Rpb24oJ21lZGlhJylcbiAgICAgICAgLmZpbmQocXVlcnkpXG4gICAgICAgIC5zb3J0KHsgY3JlYXRlZEF0OiAtMSB9KVxuICAgICAgICAuc2tpcChza2lwKVxuICAgICAgICAubGltaXQocGFyc2VJbnQobGltaXQpKVxuICAgICAgICAudG9BcnJheSgpO1xuXG4gICAgICBjb25zdCB0b3RhbCA9IGF3YWl0IGRiLmNvbGxlY3Rpb24oJ21lZGlhJykuY291bnREb2N1bWVudHMocXVlcnkpO1xuXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBtZWRpYTogbWVkaWEubWFwKGl0ZW0gPT4gKHtcbiAgICAgICAgICAuLi5pdGVtLFxuICAgICAgICAgIGlkOiBpdGVtLl9pZC50b1N0cmluZygpXG4gICAgICAgIH0pKSxcbiAgICAgICAgcGFnaW5hdGlvbjoge1xuICAgICAgICAgIGN1cnJlbnQ6IHBhcnNlSW50KHBhZ2UpLFxuICAgICAgICAgIHRvdGFsOiBNYXRoLmNlaWwodG90YWwgLyBwYXJzZUludChsaW1pdCkpLFxuICAgICAgICAgIGNvdW50OiB0b3RhbFxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgbWVkaWE6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiAnRmFpbGVkIHRvIGZldGNoIG1lZGlhJ1xuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgLy8gUE9TVCAtIFVwbG9hZCBuZXcgbWVkaWEgZmlsZVxuICBpZiAocmVxLm1ldGhvZCA9PT0gJ1BPU1QnKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHVwbG9hZERpciA9IHBhdGguam9pbihwcm9jZXNzLmN3ZCgpLCAncHVibGljL3VwbG9hZHMnKTtcbiAgICAgIFxuICAgICAgLy8gQ3JlYXRlIHVwbG9hZCBkaXJlY3RvcnkgaWYgaXQgZG9lc24ndCBleGlzdFxuICAgICAgaWYgKCFmcy5leGlzdHNTeW5jKHVwbG9hZERpcikpIHtcbiAgICAgICAgZnMubWtkaXJTeW5jKHVwbG9hZERpciwgeyByZWN1cnNpdmU6IHRydWUgfSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGZvcm0gPSBmb3JtaWRhYmxlKHtcbiAgICAgICAgdXBsb2FkRGlyLFxuICAgICAgICBrZWVwRXh0ZW5zaW9uczogdHJ1ZSxcbiAgICAgICAgbWF4RmlsZVNpemU6IDEwICogMTAyNCAqIDEwMjQsIC8vIDEwTUJcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBbZmllbGRzLCBmaWxlc10gPSBhd2FpdCBmb3JtLnBhcnNlKHJlcSk7XG5cbiAgICAgIGNvbnN0IGZpbGUgPSBBcnJheS5pc0FycmF5KGZpbGVzLmZpbGUpID8gZmlsZXMuZmlsZVswXSA6IGZpbGVzLmZpbGU7XG4gICAgICBjb25zdCB0aXRsZSA9IEFycmF5LmlzQXJyYXkoZmllbGRzLnRpdGxlKSA/IGZpZWxkcy50aXRsZVswXSA6IGZpZWxkcy50aXRsZTtcbiAgICAgIGNvbnN0IGRlc2NyaXB0aW9uID0gQXJyYXkuaXNBcnJheShmaWVsZHMuZGVzY3JpcHRpb24pID8gZmllbGRzLmRlc2NyaXB0aW9uWzBdIDogZmllbGRzLmRlc2NyaXB0aW9uO1xuICAgICAgY29uc3QgY2F0ZWdvcnkgPSBBcnJheS5pc0FycmF5KGZpZWxkcy5jYXRlZ29yeSkgPyBmaWVsZHMuY2F0ZWdvcnlbMF0gOiBmaWVsZHMuY2F0ZWdvcnk7XG5cbiAgICAgIGlmICghZmlsZSkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIGVycm9yOiAnTm8gZmlsZSB1cGxvYWRlZCdcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIEdlbmVyYXRlIHVuaXF1ZSBmaWxlbmFtZVxuICAgICAgY29uc3QgZmlsZUV4dGVuc2lvbiA9IHBhdGguZXh0bmFtZShmaWxlLm9yaWdpbmFsRmlsZW5hbWUpO1xuICAgICAgY29uc3QgdW5pcXVlSWQgPSBgbWVkaWFfJHtEYXRlLm5vdygpfV8ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cmluZygyLCAxNSl9YDtcbiAgICAgIGNvbnN0IGZpbGVuYW1lID0gYCR7dW5pcXVlSWR9JHtmaWxlRXh0ZW5zaW9ufWA7XG4gICAgICBjb25zdCBuZXdQYXRoID0gcGF0aC5qb2luKHVwbG9hZERpciwgZmlsZW5hbWUpO1xuXG4gICAgICAvLyBNb3ZlIGZpbGUgdG8gZmluYWwgbG9jYXRpb25cbiAgICAgIGZzLnJlbmFtZVN5bmMoZmlsZS5maWxlcGF0aCwgbmV3UGF0aCk7XG5cbiAgICAgIC8vIERldGVybWluZSBmaWxlIHR5cGVcbiAgICAgIGNvbnN0IG1pbWVUeXBlID0gZmlsZS5taW1ldHlwZTtcbiAgICAgIGxldCBmaWxlVHlwZSA9ICd1bmtub3duJztcbiAgICAgIGlmIChtaW1lVHlwZS5zdGFydHNXaXRoKCdpbWFnZS8nKSkge1xuICAgICAgICBmaWxlVHlwZSA9ICdpbWFnZSc7XG4gICAgICB9IGVsc2UgaWYgKG1pbWVUeXBlLnN0YXJ0c1dpdGgoJ3ZpZGVvLycpKSB7XG4gICAgICAgIGZpbGVUeXBlID0gJ3ZpZGVvJztcbiAgICAgIH1cblxuICAgICAgLy8gU2F2ZSB0byBkYXRhYmFzZVxuICAgICAgY29uc3QgbWVkaWFEb2MgPSB7XG4gICAgICAgIGlkOiB1bmlxdWVJZCxcbiAgICAgICAgZmlsZW5hbWUsXG4gICAgICAgIG9yaWdpbmFsRmlsZW5hbWU6IGZpbGUub3JpZ2luYWxGaWxlbmFtZSxcbiAgICAgICAgdGl0bGU6IHRpdGxlIHx8IGZpbGUub3JpZ2luYWxGaWxlbmFtZSxcbiAgICAgICAgZGVzY3JpcHRpb246IGRlc2NyaXB0aW9uIHx8ICcnLFxuICAgICAgICBjYXRlZ29yeTogY2F0ZWdvcnkgfHwgJ3VuY2F0ZWdvcml6ZWQnLFxuICAgICAgICBmaWxlVHlwZSxcbiAgICAgICAgbWltZVR5cGUsXG4gICAgICAgIHNpemU6IGZpbGUuc2l6ZSxcbiAgICAgICAgdXJsOiBgL3VwbG9hZHMvJHtmaWxlbmFtZX1gLFxuICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgdXNlZEluUG9zdHM6IFtdLFxuICAgICAgICB0YWdzOiBbXVxuICAgICAgfTtcblxuICAgICAgYXdhaXQgZGIuY29sbGVjdGlvbignbWVkaWEnKS5pbnNlcnRPbmUobWVkaWFEb2MpO1xuXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBtZWRpYToge1xuICAgICAgICAgIC4uLm1lZGlhRG9jLFxuICAgICAgICAgIGlkOiBtZWRpYURvYy5pZFxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgdXBsb2FkaW5nIG1lZGlhOicsIGVycm9yKTtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvcjogJ0ZhaWxlZCB0byB1cGxvYWQgbWVkaWEnXG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICAvLyBQVVQgLSBVcGRhdGUgbWVkaWEgbWV0YWRhdGFcbiAgaWYgKHJlcS5tZXRob2QgPT09ICdQVVQnKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHsgaWQsIHRpdGxlLCBkZXNjcmlwdGlvbiwgY2F0ZWdvcnksIHRhZ3MgfSA9IHJlcS5ib2R5O1xuXG4gICAgICBpZiAoIWlkKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgZXJyb3I6ICdNZWRpYSBJRCBpcyByZXF1aXJlZCdcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHVwZGF0ZURvYyA9IHtcbiAgICAgICAgdGl0bGUsXG4gICAgICAgIGRlc2NyaXB0aW9uLFxuICAgICAgICBjYXRlZ29yeSxcbiAgICAgICAgdGFnczogdGFncyB8fCBbXSxcbiAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpXG4gICAgICB9O1xuXG4gICAgICBhd2FpdCBkYi5jb2xsZWN0aW9uKCdtZWRpYScpLnVwZGF0ZU9uZShcbiAgICAgICAgeyBpZCB9LFxuICAgICAgICB7ICRzZXQ6IHVwZGF0ZURvYyB9XG4gICAgICApO1xuXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBtZXNzYWdlOiAnTWVkaWEgdXBkYXRlZCBzdWNjZXNzZnVsbHknXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgdXBkYXRpbmcgbWVkaWE6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiAnRmFpbGVkIHRvIHVwZGF0ZSBtZWRpYSdcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIC8vIERFTEVURSAtIERlbGV0ZSBtZWRpYSBmaWxlXG4gIGlmIChyZXEubWV0aG9kID09PSAnREVMRVRFJykge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB7IGlkIH0gPSByZXEucXVlcnk7XG5cbiAgICAgIGlmICghaWQpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBlcnJvcjogJ01lZGlhIElEIGlzIHJlcXVpcmVkJ1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gRmluZCBtZWRpYSBkb2N1bWVudCAtIGNoZWNrIGJvdGggaWQgYW5kIF9pZCBmaWVsZHNcbiAgICAgIGxldCBtZWRpYSA9IGF3YWl0IGRiLmNvbGxlY3Rpb24oJ21lZGlhJykuZmluZE9uZSh7IGlkIH0pO1xuICAgICAgaWYgKCFtZWRpYSkge1xuICAgICAgICAvLyBUcnkgZmluZGluZyBieSBfaWQgaWYgaWQgZmllbGQgZG9lc24ndCBleGlzdCAob25seSBpZiBpdCdzIGEgdmFsaWQgT2JqZWN0SWQpXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgaWYgKE9iamVjdElkLmlzVmFsaWQoaWQpKSB7XG4gICAgICAgICAgICBtZWRpYSA9IGF3YWl0IGRiLmNvbGxlY3Rpb24oJ21lZGlhJykuZmluZE9uZSh7IF9pZDogbmV3IE9iamVjdElkKGlkKSB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgIC8vIEludmFsaWQgT2JqZWN0SWQsIGNvbnRpbnVlIHdpdGggb3JpZ2luYWwgZXJyb3JcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKCFtZWRpYSkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oe1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIGVycm9yOiAnTWVkaWEgbm90IGZvdW5kJ1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gRGVsZXRlIGZpbGUgZnJvbSBmaWxlc3lzdGVtXG4gICAgICBjb25zdCBmaWxlUGF0aCA9IHBhdGguam9pbihwcm9jZXNzLmN3ZCgpLCAncHVibGljL3VwbG9hZHMnLCBtZWRpYS5maWxlbmFtZSk7XG4gICAgICBpZiAoZnMuZXhpc3RzU3luYyhmaWxlUGF0aCkpIHtcbiAgICAgICAgZnMudW5saW5rU3luYyhmaWxlUGF0aCk7XG4gICAgICB9XG5cbiAgICAgIC8vIERlbGV0ZSBmcm9tIGRhdGFiYXNlIC0gdXNlIHRoZSBfaWQgZm9yIHJlbGlhYmxlIGRlbGV0aW9uXG4gICAgICBhd2FpdCBkYi5jb2xsZWN0aW9uKCdtZWRpYScpLmRlbGV0ZU9uZSh7IF9pZDogbWVkaWEuX2lkIH0pO1xuXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBtZXNzYWdlOiAnTWVkaWEgZGVsZXRlZCBzdWNjZXNzZnVsbHknXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZGVsZXRpbmcgbWVkaWE6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiAnRmFpbGVkIHRvIGRlbGV0ZSBtZWRpYSdcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiByZXMuc3RhdHVzKDQwNSkuanNvbih7IGVycm9yOiAnTWV0aG9kIG5vdCBhbGxvd2VkJyB9KTtcbn0iXSwibmFtZXMiOlsiY29ubmVjdFRvRGF0YWJhc2UiLCJPYmplY3RJZCIsImZvcm1pZGFibGUiLCJmcyIsInBhdGgiLCJjb25maWciLCJhcGkiLCJib2R5UGFyc2VyIiwiaGFuZGxlciIsInJlcSIsInJlcyIsImRiIiwibWV0aG9kIiwiY2F0ZWdvcnkiLCJzZWFyY2giLCJwYWdlIiwibGltaXQiLCJxdWVyeSIsIiRvciIsImZpbGVuYW1lIiwiJHJlZ2V4IiwiJG9wdGlvbnMiLCJ0aXRsZSIsImRlc2NyaXB0aW9uIiwic2tpcCIsInBhcnNlSW50IiwibWVkaWEiLCJjb2xsZWN0aW9uIiwiZmluZCIsInNvcnQiLCJjcmVhdGVkQXQiLCJ0b0FycmF5IiwidG90YWwiLCJjb3VudERvY3VtZW50cyIsInN0YXR1cyIsImpzb24iLCJzdWNjZXNzIiwibWFwIiwiaXRlbSIsImlkIiwiX2lkIiwidG9TdHJpbmciLCJwYWdpbmF0aW9uIiwiY3VycmVudCIsIk1hdGgiLCJjZWlsIiwiY291bnQiLCJlcnJvciIsImNvbnNvbGUiLCJ1cGxvYWREaXIiLCJqb2luIiwicHJvY2VzcyIsImN3ZCIsImV4aXN0c1N5bmMiLCJta2RpclN5bmMiLCJyZWN1cnNpdmUiLCJmb3JtIiwia2VlcEV4dGVuc2lvbnMiLCJtYXhGaWxlU2l6ZSIsImZpZWxkcyIsImZpbGVzIiwicGFyc2UiLCJmaWxlIiwiQXJyYXkiLCJpc0FycmF5IiwiZmlsZUV4dGVuc2lvbiIsImV4dG5hbWUiLCJvcmlnaW5hbEZpbGVuYW1lIiwidW5pcXVlSWQiLCJEYXRlIiwibm93IiwicmFuZG9tIiwic3Vic3RyaW5nIiwibmV3UGF0aCIsInJlbmFtZVN5bmMiLCJmaWxlcGF0aCIsIm1pbWVUeXBlIiwibWltZXR5cGUiLCJmaWxlVHlwZSIsInN0YXJ0c1dpdGgiLCJtZWRpYURvYyIsInNpemUiLCJ1cmwiLCJ1cGRhdGVkQXQiLCJ1c2VkSW5Qb3N0cyIsInRhZ3MiLCJpbnNlcnRPbmUiLCJib2R5IiwidXBkYXRlRG9jIiwidXBkYXRlT25lIiwiJHNldCIsIm1lc3NhZ2UiLCJmaW5kT25lIiwiaXNWYWxpZCIsImVyciIsImZpbGVQYXRoIiwidW5saW5rU3luYyIsImRlbGV0ZU9uZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api-node)/./src/pages/api/media.js\n");

/***/ }),

/***/ "(api-node)/./src/utils/mongodb.ts":
/*!******************************!*\
  !*** ./src/utils/mongodb.ts ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   clientPromise: () => (/* binding */ clientPromise),\n/* harmony export */   connectToDatabase: () => (/* binding */ connectToDatabase),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! mongodb */ \"mongodb\");\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(mongodb__WEBPACK_IMPORTED_MODULE_0__);\n\nconst MONGODB_URI = process.env.MONGODB_URI;\nconst MONGODB_DB = 'NGO';\n// Check the MongoDB URI\nif (!MONGODB_URI) {\n    throw new Error('Please define the MONGODB_URI environment variable');\n}\n// Global object to store the MongoDB connection\nlet cachedClient = null;\nlet cachedDb = null;\n// Create a MongoDB client promise for NextAuth\nlet clientPromise;\nif (true) {\n    // In development mode, use a global variable so that the value\n    // is preserved across module reloads caused by HMR (Hot Module Replacement).\n    const globalWithMongo = global;\n    if (!globalWithMongo._mongoClientPromise) {\n        const client = new mongodb__WEBPACK_IMPORTED_MODULE_0__.MongoClient(MONGODB_URI);\n        globalWithMongo._mongoClientPromise = client.connect();\n    }\n    clientPromise = globalWithMongo._mongoClientPromise;\n} else {}\n// Export a module-scoped MongoClient promise. By doing this in a\n// separate module, the client can be shared across functions.\n\nasync function connectToDatabase() {\n    // If we already have a connection, use it\n    if (cachedClient && cachedDb) {\n        return {\n            client: cachedClient,\n            db: cachedDb\n        };\n    }\n    // If no connection exists, use the client promise\n    const client = await clientPromise;\n    const db = client.db(MONGODB_DB);\n    // Cache the client and db connection\n    cachedClient = client;\n    cachedDb = db;\n    return {\n        client,\n        db\n    };\n}\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (connectToDatabase);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL3NyYy91dGlscy9tb25nb2RiLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQTBDO0FBRTFDLE1BQU1DLGNBQWNDLFFBQVFDLEdBQUcsQ0FBQ0YsV0FBVztBQUMzQyxNQUFNRyxhQUFhO0FBRW5CLHdCQUF3QjtBQUN4QixJQUFJLENBQUNILGFBQWE7SUFDaEIsTUFBTSxJQUFJSSxNQUFNO0FBQ2xCO0FBRUEsZ0RBQWdEO0FBQ2hELElBQUlDLGVBQW1DO0FBQ3ZDLElBQUlDLFdBQXNCO0FBRTFCLCtDQUErQztBQUMvQyxJQUFJQztBQUVKLElBQUlOLElBQXNDLEVBQUU7SUFDMUMsK0RBQStEO0lBQy9ELDZFQUE2RTtJQUM3RSxNQUFNTyxrQkFBa0JDO0lBSXhCLElBQUksQ0FBQ0QsZ0JBQWdCRSxtQkFBbUIsRUFBRTtRQUN4QyxNQUFNQyxTQUFTLElBQUlaLGdEQUFXQSxDQUFDQztRQUMvQlEsZ0JBQWdCRSxtQkFBbUIsR0FBR0MsT0FBT0MsT0FBTztJQUN0RDtJQUNBTCxnQkFBZ0JDLGdCQUFnQkUsbUJBQW1CO0FBQ3JELE9BQU8sRUFJTjtBQUVELGlFQUFpRTtBQUNqRSw4REFBOEQ7QUFDckM7QUFFbEIsZUFBZUc7SUFDcEIsMENBQTBDO0lBQzFDLElBQUlSLGdCQUFnQkMsVUFBVTtRQUM1QixPQUFPO1lBQUVLLFFBQVFOO1lBQWNTLElBQUlSO1FBQVM7SUFDOUM7SUFFQSxrREFBa0Q7SUFDbEQsTUFBTUssU0FBUyxNQUFNSjtJQUNyQixNQUFNTyxLQUFLSCxPQUFPRyxFQUFFLENBQUNYO0lBRXJCLHFDQUFxQztJQUNyQ0UsZUFBZU07SUFDZkwsV0FBV1E7SUFFWCxPQUFPO1FBQUVIO1FBQVFHO0lBQUc7QUFDdEI7QUFFQSxpRUFBZUQsaUJBQWlCQSxFQUFDIiwic291cmNlcyI6WyIvVXNlcnMvYW5hbmQuc29jaWFsL0RvY3VtZW50cy9uMGgwdXBsL3NyYy91dGlscy9tb25nb2RiLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE1vbmdvQ2xpZW50LCBEYiB9IGZyb20gJ21vbmdvZGInO1xuXG5jb25zdCBNT05HT0RCX1VSSSA9IHByb2Nlc3MuZW52Lk1PTkdPREJfVVJJO1xuY29uc3QgTU9OR09EQl9EQiA9ICdOR08nO1xuXG4vLyBDaGVjayB0aGUgTW9uZ29EQiBVUklcbmlmICghTU9OR09EQl9VUkkpIHtcbiAgdGhyb3cgbmV3IEVycm9yKCdQbGVhc2UgZGVmaW5lIHRoZSBNT05HT0RCX1VSSSBlbnZpcm9ubWVudCB2YXJpYWJsZScpO1xufVxuXG4vLyBHbG9iYWwgb2JqZWN0IHRvIHN0b3JlIHRoZSBNb25nb0RCIGNvbm5lY3Rpb25cbmxldCBjYWNoZWRDbGllbnQ6IE1vbmdvQ2xpZW50IHwgbnVsbCA9IG51bGw7XG5sZXQgY2FjaGVkRGI6IERiIHwgbnVsbCA9IG51bGw7XG5cbi8vIENyZWF0ZSBhIE1vbmdvREIgY2xpZW50IHByb21pc2UgZm9yIE5leHRBdXRoXG5sZXQgY2xpZW50UHJvbWlzZTogUHJvbWlzZTxNb25nb0NsaWVudD47XG5cbmlmIChwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ2RldmVsb3BtZW50Jykge1xuICAvLyBJbiBkZXZlbG9wbWVudCBtb2RlLCB1c2UgYSBnbG9iYWwgdmFyaWFibGUgc28gdGhhdCB0aGUgdmFsdWVcbiAgLy8gaXMgcHJlc2VydmVkIGFjcm9zcyBtb2R1bGUgcmVsb2FkcyBjYXVzZWQgYnkgSE1SIChIb3QgTW9kdWxlIFJlcGxhY2VtZW50KS5cbiAgY29uc3QgZ2xvYmFsV2l0aE1vbmdvID0gZ2xvYmFsIGFzIHR5cGVvZiBnbG9iYWxUaGlzICYge1xuICAgIF9tb25nb0NsaWVudFByb21pc2U/OiBQcm9taXNlPE1vbmdvQ2xpZW50PjtcbiAgfTtcblxuICBpZiAoIWdsb2JhbFdpdGhNb25nby5fbW9uZ29DbGllbnRQcm9taXNlKSB7XG4gICAgY29uc3QgY2xpZW50ID0gbmV3IE1vbmdvQ2xpZW50KE1PTkdPREJfVVJJIGFzIHN0cmluZyk7XG4gICAgZ2xvYmFsV2l0aE1vbmdvLl9tb25nb0NsaWVudFByb21pc2UgPSBjbGllbnQuY29ubmVjdCgpO1xuICB9XG4gIGNsaWVudFByb21pc2UgPSBnbG9iYWxXaXRoTW9uZ28uX21vbmdvQ2xpZW50UHJvbWlzZTtcbn0gZWxzZSB7XG4gIC8vIEluIHByb2R1Y3Rpb24gbW9kZSwgaXQncyBiZXN0IHRvIG5vdCB1c2UgYSBnbG9iYWwgdmFyaWFibGUuXG4gIGNvbnN0IGNsaWVudCA9IG5ldyBNb25nb0NsaWVudChNT05HT0RCX1VSSSBhcyBzdHJpbmcpO1xuICBjbGllbnRQcm9taXNlID0gY2xpZW50LmNvbm5lY3QoKTtcbn1cblxuLy8gRXhwb3J0IGEgbW9kdWxlLXNjb3BlZCBNb25nb0NsaWVudCBwcm9taXNlLiBCeSBkb2luZyB0aGlzIGluIGFcbi8vIHNlcGFyYXRlIG1vZHVsZSwgdGhlIGNsaWVudCBjYW4gYmUgc2hhcmVkIGFjcm9zcyBmdW5jdGlvbnMuXG5leHBvcnQgeyBjbGllbnRQcm9taXNlIH07XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjb25uZWN0VG9EYXRhYmFzZSgpOiBQcm9taXNlPHsgY2xpZW50OiBNb25nb0NsaWVudDsgZGI6IERiIH0+IHtcbiAgLy8gSWYgd2UgYWxyZWFkeSBoYXZlIGEgY29ubmVjdGlvbiwgdXNlIGl0XG4gIGlmIChjYWNoZWRDbGllbnQgJiYgY2FjaGVkRGIpIHtcbiAgICByZXR1cm4geyBjbGllbnQ6IGNhY2hlZENsaWVudCwgZGI6IGNhY2hlZERiIH07XG4gIH1cblxuICAvLyBJZiBubyBjb25uZWN0aW9uIGV4aXN0cywgdXNlIHRoZSBjbGllbnQgcHJvbWlzZVxuICBjb25zdCBjbGllbnQgPSBhd2FpdCBjbGllbnRQcm9taXNlO1xuICBjb25zdCBkYiA9IGNsaWVudC5kYihNT05HT0RCX0RCKTtcblxuICAvLyBDYWNoZSB0aGUgY2xpZW50IGFuZCBkYiBjb25uZWN0aW9uXG4gIGNhY2hlZENsaWVudCA9IGNsaWVudDtcbiAgY2FjaGVkRGIgPSBkYjtcblxuICByZXR1cm4geyBjbGllbnQsIGRiIH07XG59XG5cbmV4cG9ydCBkZWZhdWx0IGNvbm5lY3RUb0RhdGFiYXNlO1xuIl0sIm5hbWVzIjpbIk1vbmdvQ2xpZW50IiwiTU9OR09EQl9VUkkiLCJwcm9jZXNzIiwiZW52IiwiTU9OR09EQl9EQiIsIkVycm9yIiwiY2FjaGVkQ2xpZW50IiwiY2FjaGVkRGIiLCJjbGllbnRQcm9taXNlIiwiZ2xvYmFsV2l0aE1vbmdvIiwiZ2xvYmFsIiwiX21vbmdvQ2xpZW50UHJvbWlzZSIsImNsaWVudCIsImNvbm5lY3QiLCJjb25uZWN0VG9EYXRhYmFzZSIsImRiIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api-node)/./src/utils/mongodb.ts\n");

/***/ }),

/***/ "formidable":
/*!*****************************!*\
  !*** external "formidable" ***!
  \*****************************/
/***/ ((module) => {

module.exports = import("formidable");;

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("fs");

/***/ }),

/***/ "mongodb":
/*!**************************!*\
  !*** external "mongodb" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("mongodb");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fmedia&preferredRegion=&absolutePagePath=.%2Fsrc%2Fpages%2Fapi%2Fmedia.js&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();